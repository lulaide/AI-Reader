# /etc/nginx/conf.d/default.conf

server {
    # 监听 80 端口
    listen 80;

    # 根目录，指向我们复制进来的静态文件
    root /usr/share/nginx/html;
    # 默认服务的文件
    index index.html index.htm;

    # 处理前端路由
    # 对于所有请求，首先尝试作为文件查找，然后作为目录查找，
    # 如果都失败，则返回 index.html，让 React Router接管
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 处理对后端 API 的代理
    # 所有 /api/ 开头的请求都会被转发
    location /api/ {
        # 'backend' 是你后端服务在容器网络中的名字
        # 例如，在 docker-compose.yml 中，这可能是 service 的名字
        # 4000 是后端 Flask 应用运行的端口
        proxy_pass http://backend-service:4000;

        # 设置一些代理头部，以便后端能正确获取信息
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 可以选择性地添加错误页面配置
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
